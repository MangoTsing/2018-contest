<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>2048</title>
</head>
<style>
	body{
		margin:0;
		padding: 0;
	}
	main{
		height: 500px;
		width: 500px;
		margin: 0 auto;
	}
	#container{
		display: flex;
		flex-direction: row;
		height: 408px;
		width: 408px;
		opacity: 0.5;
		background: #50fc1a;
		flex-wrap:wrap;
		justify-content: center;
		
		/*outline: 0 none;*/
	}
	.item{
		
	    width: 100px;
	    height: 100px;
	    font-size: 40px;
	    line-height: 40px;
	    border: 1px solid black;
	    text-align: center;
		background: #ccc0b2;
		align-items:flex-start;
		-webkit-touch-callout: none; /* iOS Safari */

		-webkit-user-select: none; /* Chrome/Safari/Opera */

		-khtml-user-select: none; /* Konqueror */

		-moz-user-select: none; /* Firefox */

		-ms-user-select: none; /* Internet Explorer/Edge */

		user-select: none;
				/* 拖拽时禁止选中 */
	}
.n0{
    background: #ccc0b2;
}
 .n2
{
    color: #7c736a;
    background: #eee4da;
}
 .n4
{
    color: #7c736a;
    background: #ece0c8;
}
 .n8
{
    color: #fff7eb;
    background: #f2b179;
}
 .n16
{
    color:#fff7eb;
    background:#f59563;
}
 .n32
{
    color:#fff7eb;
    background:#f57c5f;
}
 .n64
{
    color:#fff7eb;
    background:#f65d3b;
}
 .n128
{
    color:#fff7eb;
    background:#edce71;
}
 .n256
{
    color:#fff7eb;
    background:#edcc61;
}
 .n512
{
    color:#fff7eb;
    background:#ecc850;
}
 .n1024
{
    color:#fff7eb;
    background:#edc53f;
}
 .n2048
{
    color:#fff7eb;
    background:#eec22e;
}
</style>
<body>
	<main>
	
		<div class="main">
			<button id="btn">4*4</button>
			<div class="container" id="container">
            	<div class="item" id="item1"></div>
            	<div class="item" id="item2"></div>
            	<div class="item" id="item3"></div>
            	<div class="item" id="item4"></div>
            	<div class="item" id="item5"></div>
            	<div class="item" id="item6"></div>
            	<div class="item" id="item7"></div>
            	<div class="item" id="item8"></div>
            	<div class="item" id="item9"></div>
            	<div class="item" id="item10"></div>
            	<div class="item" id="item11"></div>
            	<div class="item" id="item12"></div>
            	<div class="item" id="item13"></div>
            	<div class="item" id="item14"></div>
            	<div class="item" id="item15"></div>
            	<div class="item" id="item16"></div>
            	
        	</div>
		</div><span id="score">score</span>
	</main>
</body>
<script>
var sgypGame={
	Heng:4,
	Shu:4,
	data:null,
	score:0,
	start:function(){
    	this.data=new Array();
    	for(var i=0;i<this.Heng;i++){
            this.data[i]=[];
            for(var j=0;
                j<this.Shu;
                this.data[i][j]=0,j++);
        }
    //将data做一个4*4矩阵数组
    	this.someNum();
    	this.someNum();
    	this.resetFlex();
    	//先运行一次resetflex，再绑定
    	document.onkeydown=function(e){
            switch(e.keyCode){
                case 37: this.moveLeft();break;
                case 38: this.moveUp();break;
                case 39: this.moveRight();break;
                case 40: this.moveDown();break;
            }
        }.bind(this);
	},
	resetFlex:function(){
        for(var r=0;r<this.Heng;r++){
            for(var c=0;c<this.Shu;c++){
            	
                var oDiv= document.getElementById("item"+(r+c+1));
                //console.log('item'+(r+c+1));
                if(this.data[r][c]!=0){
                    oDiv.innerHTML=this.data[r][c];
                    oDiv.className="n"+this.data[r][c];
                }else{//否则
                    oDiv.innerHTML="";
                    oDiv.className="item n0";
                }
            }
        }
        //找到id为score的元素，设置其内容为score属性
        document.getElementById("score").innerHTML=this.score;
        //如果游戏状态为结束
        // if(this.state==this.GAMEOVER){
        //     document.getElementById("gameover").style.display="block";
        //     document.getElementById("final").innerHTML=this.score;
        // }else{
        //     document.getElementById("gameover").style.display="none";
        // }
    },
    move:function(callback){
        var before=String(this.data);
        callback();//this->window
        var after=String(this.data);
        if(before!=after){
            this.randomNum();
            if(this.isGameOver()){
                this.state=this.GAMEOVER;
            }
            this.updateView();
        }
    },
    isGameOver:function(){
        for(var r=0;r<this.RN;r++){
            for(var c=0;c<this.CN;c++){
                if(this.data[r][c]==0){return false;}
                else if(c<this.CN-1
                    &&this.data[r][c]==this.data[r][c+1]){
                    return false;
                }
                else if(r<this.RN-1
                    &&this.data[r][c]==this.data[r+1][c]){
                    return false;
                }
            }
        }
        return true;
    },
    moveLeft:function(){
        this.move(function(){
            for(var r=0;r<this.RN;r++){
                this.moveLeftInRow(r);
            }
        }.bind(this));/*this是moveLeft方法的this*/
    },
    moveLeftInRow:function(r){
        for(var c=0;c<this.CN-1;c++){
            var nextc=this.getNextInRow(r,c);
            if(nextc==-1){break;}
            else{
                if(this.data[r][c]==0){
                    this.data[r][c]=this.data[r][nextc];
                    this.data[r][nextc]=0;
                    c--;
                }else if(this.data[r][c]
                    ==this.data[r][nextc]){
                    this.data[r][c]*=2;
                    this.score+=this.data[r][c];
                    this.data[r][nextc]=0;
                }
            }
        }
    },
    getNextInRow:function(r,c){
        c++;
        for(;c<this.CN;c++){
            if(this.data[r][c]!=0){
                return c;
            }
        }
        return -1;
    },
    moveRight:function(){
        this.move(function(){
            for(var r=0;r<this.RN;r++){
                this.moveRightInRow(r);
            }
        }.bind(this));
    },
    moveRightInRow:function(r){
        for(var c=this.CN-1;c>0;c--){
            var prevc=this.getPrevInRow(r,c);
            if(prevc==-1){break;}
            else{
                if(this.data[r][c]==0){
                    this.data[r][c]=this.data[r][prevc];
                    this.data[r][prevc]=0;
                    c++;
                }else if(this.data[r][c] ==this.data[r][prevc]){
                    this.data[r][c]*=2;
                    this.score+=this.data[r][c];
                    this.data[r][prevc]=0;
                }
            }
        }
    },
    getPrevInRow:function(r,c){
        c--;
        for(;c>=0;c--){
            if(this.data[r][c]!=0){
                return c;
            }
        }
        return -1;
    },
    moveUp:function(){
        this.move(function(){
            for(var c=0;c<this.CN;c++){
                this.moveUpInCol(c);
            }
        }.bind(this));
    },
    moveUpInCol:function(c){
        for(var r=0;r<this.RN-1;r++){
            var nextr=this.getNextInCol(r,c);
            if(nextr==-1){break;}
            else{
                if(this.data[r][c]==0){
                    this.data[r][c]=this.data[nextr][c];
                    this.data[nextr][c]=0;
                    r--;
                }else if(this.data[r][c]
                    ==this.data[nextr][c]){
                    this.data[r][c]*=2;
                    this.score+=this.data[r][c];
                    this.data[nextr][c]=0;
                }
            }
        }
    },
    getNextInCol:function(r,c){
        r++;
        for(;r<this.RN;r++){
            if(this.data[r][c]!=0){
                return r;
            }
        }
        return -1;
    },
    moveDown:function(){
        this.move(function(){
            for(var c=0;c<this.CN;c++){
                this.moveDownInCol(c);
            }
        }.bind(this));
    },
    moveDownInCol:function(c){
        for(var r=this.RN-1;r>0;r--){
            var prevr=this.getPrevInCol(r,c);
            if(prevr==-1){break;}
            else{
                if(this.data[r][c]==0){
                    this.data[r][c]=this.data[prevr][c];
                    this.data[prevr][c]=0;
                    r++;
                }else if(this.data[r][c]
                    ==this.data[prevr][c]){
                    this.data[r][c]*=2;
                    this.score+=this.data[r][c];
                    this.data[prevr][c]=0;
                }
            }
        }
    },
    getPrevInCol:function(r,c){
        r--;
        for(;r>=0;r--){
            if(this.data[r][c]!=0)
                return r;
        }
        return -1;
    },
	someNum:function(){
		//算出随机数
            var h=Math.floor(Math.random()*(this.Heng));
            var s=Math.floor(Math.random()*(this.Shu));
            if(this.data[h][s]==0){
                if(Math.round(Math.random())){
                	this.data[h][s]=2;
                }else{
                	this.data[h][s]=4;
                }
                
            }
           
        
        
    }
}
sgypGame.start();
</script>
</html>